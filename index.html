<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Toddler Learning | Home</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@700;900&display=swap');

        :root {
            --ios-bg: #F2F2F7;
            --nike-black: #111111;
            --apple-blue: #007AFF;
            --apple-green: #34C759;
            --apple-yellow: #FFCC00;
            --apple-purple: #AF52DE;
            --apple-red: #FF3B30;
            --card-shadow: 0 20px 40px rgba(0,0,0,0.1);
            --radius: 32px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--ios-bg); color: var(--nike-black); overflow: hidden; height: 100vh; }

        .screen { display: none; flex-direction: column; align-items: center; width: 100%; height: 100%; padding: 20px; }
        .active { display: flex; }

        /* Menu Styles */
        .menu-container { justify-content: center; gap: 15px; overflow-y: auto; text-align: center; }
        .menu-btn { 
            width: 100%; max-width: 350px; padding: 22px; border-radius: 24px; 
            border: none; font-size: 1.6rem; font-weight: 900; color: white; cursor: pointer;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1); transition: 0.1s;
        }
        .menu-btn:active { transform: translateY(3px); box-shadow: 0 3px 0 rgba(0,0,0,0.1); }

        /* Progress Bar */
        .prog-wrap { width: 100%; max-width: 450px; margin-bottom: 10px; }
        .prog-bar-outer { height: 14px; background: #E5E5EA; border-radius: 7px; overflow: hidden; }
        .prog-bar-inner { height: 100%; background: var(--apple-blue); width: 0%; transition: width 0.4s ease; }

        /* Main Game Card */
        .main-card { 
            background: white; width: 100%; max-width: 450px; border-radius: var(--radius); 
            box-shadow: var(--card-shadow); flex: 1; display: flex; flex-direction: column; 
            margin-bottom: 15px; overflow: hidden; 
        }

        /* Math Visuals */
        .visual-row { display: flex; align-items: center; justify-content: center; gap: 15px; padding: 15px; background: #fafafa; }
        .visual-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; flex: 1; }
        .num-label { font-size: 3rem; font-weight: 900; color: var(--nike-black); min-width: 50px; text-align: center; }
        .mini-fruit { width: 65px; height: 65px; object-fit: contain; transition: 0.1s; }
        .mini-fruit:active { transform: scale(1.3); }

        /* Inputs */
        .math-op-sign { font-size: 4rem; font-weight: 900; color: var(--apple-blue); margin: 0; }
        .answer-input { width: 60%; font-size: 4.5rem; text-align: center; border: 5px solid var(--ios-bg); border-radius: 25px; display: block; margin: 10px auto; font-weight: 900; }

        /* Overlay */
        #discovery-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 2000; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        .sunburst { position: absolute; width: 500px; height: 500px; background: radial-gradient(circle, var(--apple-yellow) 0%, transparent 70%); animation: rotate 20s linear infinite; z-index: -1; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .footer-nav { padding-bottom: 15px; }
        .home-link { font-weight: 800; color: #8E8E93; cursor: pointer; text-decoration: none; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active menu-container">
        <h1 style="font-size: 2.5rem;">Main Menu</h1>
        <button class="menu-btn" style="background:var(--apple-purple)" onclick="showStickers()">‚≠ê STICKER BOOK</button>
        <hr style="width: 80%; opacity: 0.3;">
        <button class="menu-btn" style="background:#FF9500" onclick="startApp('fruits')">üçé FRUIT NAMES</button>
        <button class="menu-btn" style="background:var(--apple-blue)" onclick="showMathOps()">‚ûï MATH GAMES</button>
    </div>

    <div id="math-op-screen" class="screen menu-container">
        <h1>Pick Math Type</h1>
        <button class="menu-btn" style="background:var(--apple-green)" onclick="selectOp('+')">ADDITION (+)</button>
        <button class="menu-btn" style="background:var(--apple-red)" onclick="selectOp('-')">SUBTRACTION (-)</button>
        <button class="menu-btn" style="background:var(--apple-purple)" onclick="selectOp('*')">MULTIPLICATION (√ó)</button>
        <div class="footer-nav"><span class="home-link" onclick="goHome()">üè† HOME</span></div>
    </div>

    <div id="difficulty-screen" class="screen menu-container">
        <h1>How Hard?</h1>
        <button class="menu-btn" style="background:var(--apple-green)" onclick="setDifficulty('easy')">EASY (1-5)</button>
        <button class="menu-btn" style="background:var(--apple-yellow); color:black;" onclick="setDifficulty('med')">MEDIUM (1-10)</button>
        <button class="menu-btn" style="background:var(--apple-red)" onclick="setDifficulty('hard')">HARD (1-20)</button>
        <div class="footer-nav"><span class="home-link" onclick="goHome()">üè† HOME</span></div>
    </div>

    <div id="sticker-screen" class="screen">
        <h1>My Stickers</h1>
        <div id="sticker-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; padding:20px;"></div>
        <button class="menu-btn" style="background:var(--apple-blue)" onclick="goHome()">BACK</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="prog-wrap">
            <div id="prog-label" style="text-align:right; font-weight:700; color:#8E8E93;">0/5</div>
            <div class="prog-bar-outer"><div id="prog-bar" class="prog-bar-inner"></div></div>
        </div>
        <div class="main-card">
            <div id="ui-fruits" style="display:none; flex:1; flex-direction:column; align-items:center; justify-content:center;">
                <img id="f-img" style="max-width:80%; height:250px; object-fit:contain;" src="">
                <h2 id="f-txt" style="font-size:3.5rem; margin:20px 0;"></h2>
                <button onclick="speakFruit()" style="width:90%; padding:20px; border-radius:20px; background:var(--apple-blue); color:white; border:none; font-weight:900; font-size:1.5rem;">üîä SAY IT</button>
            </div>
            <div id="ui-math" style="display:none; flex:1; flex-direction:column;">
                <div class="visual-row">
                    <div id="v-group1" class="visual-box"></div>
                    <div id="v-num1" class="num-label">0</div>
                </div>
                <div id="v-op-sign" class="math-op-sign" style="text-align:center;">+</div>
                <div class="visual-row">
                    <div id="v-group2" class="visual-box"></div>
                    <div id="v-num2" class="num-label">0</div>
                </div>
                <div style="padding:20px; text-align:center;">
                    <input type="number" id="m-ans" class="answer-input" placeholder="?" inputmode="numeric">
                    <button onclick="checkMath()" style="width:100%; padding:20px; border-radius:20px; background:var(--apple-green); color:white; border:none; font-weight:900; font-size:1.5rem;">CHECK</button>
                </div>
            </div>
        </div>
        <div class="footer-nav"><span class="home-link" onclick="goHome()">üè† HOME</span></div>
    </div>

    <div id="discovery-overlay" onclick="closeDiscovery()">
        <div class="sunburst"></div>
        <h2>NEW STICKER!</h2>
        <img id="new-sticker-img" style="width:200px; height:200px; object-fit:contain;" src="">
        <h1 id="new-sticker-name" style="color:var(--apple-yellow);"></h1>
        <p>Tap to continue</p>
    </div>

    <script>
        const synth = window.speechSynthesis;
        const folder = "fruits/";
        const fruitData = ["apple", "banana", "mango", "orange", "strawberry", "pineapple", "grapes", "watermelon", "cherry"];
        
        let state = {
            mode: '', op: '+', level: 'easy', idx: 0, 
            ans: 0, stickers: JSON.parse(localStorage.getItem('stickers')) || []
        };

        function goHome() { location.reload(); }
        function showMathOps() { switchScreen('math-op-screen'); }
        function selectOp(op) { state.op = op; switchScreen('difficulty-screen'); }
        function setDifficulty(lvl) { state.level = lvl; startApp('math'); }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startApp(mode) {
            state.mode = mode;
            state.idx = 0;
            switchScreen('game-screen');
            if(mode === 'fruits') {
                document.getElementById('ui-fruits').style.display = 'flex';
                document.getElementById('ui-math').style.display = 'none';
                updateFruit();
            } else {
                document.getElementById('ui-fruits').style.display = 'none';
                document.getElementById('ui-math').style.display = 'flex';
                generateMath();
            }
        }

        function updateFruit() {
            const f = fruitData[state.idx];
            document.getElementById('f-img').src = `${folder}${f}.png`;
            document.getElementById('f-txt').innerText = f.toUpperCase();
            updateProg(state.idx + 1, fruitData.length);
        }

        function speakFruit() {
            const u = new SpeechSynthesisUtterance(fruitData[state.idx]);
            u.onend = () => {
                state.idx++;
                if(state.idx < fruitData.length) updateFruit();
                else goHome();
            };
            synth.speak(u);
        }

        function generateMath() {
            let max = state.level === 'easy' ? 5 : state.level === 'med' ? 10 : 20;
            let a = Math.floor(Math.random() * max) + 1;
            let b = Math.floor(Math.random() * max) + 1;
            
            if(state.op === '-' && a < b) [a, b] = [b, a];
            state.ans = eval(`${a}${state.op}${b}`);

            document.getElementById('v-op-sign').innerText = state.op.replace('*','√ó');
            document.getElementById('v-num1').innerText = a;
            document.getElementById('v-num2').innerText = b;
            
            drawVisuals('v-group1', a, fruitData[0]);
            drawVisuals('v-group2', b, fruitData[1]);
            document.getElementById('m-ans').value = '';
            updateProg(state.idx + 1, 5);
        }

        function drawVisuals(id, count, img) {
            const div = document.getElementById(id);
            div.innerHTML = '';
            for(let i=0; i<count; i++) {
                div.innerHTML += `<img src="${folder}${img}.png" class="mini-fruit">`;
            }
        }

        function checkMath() {
            const val = parseInt(document.getElementById('m-ans').value);
            if(val === state.ans) {
                const f = fruitData[Math.floor(Math.random() * fruitData.length)];
                if(!state.stickers.includes(f)) {
                    state.stickers.push(f);
                    localStorage.setItem('stickers', JSON.stringify(state.stickers));
                    showDiscovery(f);
                } else { say("Right!"); }
                state.idx++;
                if(state.idx >= 5) setTimeout(goHome, 2000);
                else setTimeout(generateMath, 1500);
            } else { say("Try again"); }
        }

        function showDiscovery(f) {
            document.getElementById('new-sticker-img').src = `${folder}${f}.png`;
            document.getElementById('new-sticker-name').innerText = f.toUpperCase();
            document.getElementById('discovery-overlay').style.display = 'flex';
        }
        function closeDiscovery() { document.getElementById('discovery-overlay').style.display = 'none'; }

        function showStickers() {
            switchScreen('sticker-screen');
            const grid = document.getElementById('sticker-grid');
            grid.innerHTML = '';
            fruitData.forEach(f => {
                const earned = state.stickers.includes(f);
                grid.innerHTML += `<div style="background:white; border-radius:15px; height:80px; display:flex; align-items:center; justify-content:center;">
                    <img src="${folder}${f}.png" style="width:60%; opacity:${earned?1:0.1}; filter:grayscale(${earned?0:1})">
                </div>`;
            });
        }

        function updateProg(c, t) {
            document.getElementById('prog-bar').style.width = (c/t)*100 + '%';
            document.getElementById('prog-label').innerText = `${c}/${t}`;
        }
        function say(t) { synth.cancel(); synth.speak(new SpeechSynthesisUtterance(t)); }
    </script>
</body>
</html>
